# 2026-01-30

## Lesson Learned: Gateway Restarts During Multi-Step Operations

**What happened:** During a security audit, I chained a config patch (which auto-triggers a restart) in the middle of a tool sequence. The restart interrupted the session and I became unresponsive before delivering the final summary.

**Prevention rules:**
1. **Complete responses before restarts** — Finish summarizing/responding THEN trigger restart as separate step
2. **Warn before restart-triggering actions** — Tell Chuck "I'm about to apply a config that restarts the gateway" before doing it
3. **Break up multi-step operations** — Respond between major steps rather than chaining everything in one turn

## Security Audit Completed

**Fixed:**
- File permissions: All dirs under `~/.clawdbot/` now 700, files 600
- Added `logging.redactSensitive: "tools"` to config

**Already Secure:**
- Gateway: `bind: "loopback"` ✅
- Gateway: `auth.mode: "token"` ✅  
- Telegram: `dmPolicy: "pairing"` ✅
- Telegram: `groupPolicy: "allowlist"` ✅
- Bot token now uses env var `${TELEGRAM_BOT_TOKEN}` ✅

## Telegram Setup

- Paired Chuck's Telegram account (user id: 7408930331)
- Bot token switched from hardcoded to env var reference

## Auth Setup: Switched to Max Subscription OAuth

- Changed from API key to OAuth token for Anthropic
- Files involved:
  - `~/.clawdbot/clawdbot.json` — auth.profiles + auth.order
  - `~/.clawdbot/agents/main/agent/auth-profiles.json` — actual tokens + lastGood

## Lesson Learned: Config Changes via CLI

**Use CLI for config changes, not chat.** Reasons:
1. Config file edits trigger hot-reload, which crashes the chat session mid-response
2. CLI commands handle restarts gracefully (they complete before restart)
3. Interactive prompts (paste-token, OAuth flows) need proper TTY
4. Let Chuck run `clawdbot gateway restart` manually when needed

**Rule:** I should explain what needs to change, give Chuck the CLI commands, and let him run them.

## Communication Preference: Quick Acks

Chuck wants immediate acknowledgment before I start working on something. Examples:
- "Got it, working on that now"
- "On it"
- "Looking into this"

Don't leave him waiting wondering if I crashed or got the message.

## Rule: Sub-Agents for Long Tasks

If a task might take extended time (research, multi-step operations, complex debugging), spawn a sub-agent so the main chat stays responsive. Chuck can keep talking to me while background work runs.

## Rule: No Clawdbot Config Changes

I don't edit `~/.clawdbot/` files directly. I explain what needs to change and give Chuck CLI commands to run. He handles all config + restarts.

## Rule: Timeouts + Alert on Stuck

- Always set timeouts on shell commands (don't hang forever)
- If a command times out or I seem stuck, ping Chuck on Telegram: "I'm blocked — might need you to check the Mac for a dialog"
- Don't leave him guessing — proactive communication

## Rule: Use 1Password, Not Keychain

Store credentials in 1Password (Gomez vault), not macOS Keychain. Access via `op` CLI.

## Infrastructure Note: Mac Mini Access

- Chuck can access Mac Mini remotely via Tailscale tunnel + Screen Sharing
- Clawdbot gateway is loopback-only (not exposed to Tailscale)
- This is intentional — Clawdbot stays locked down, Chuck uses screen share for remote Mac access if needed

## Email Setup Complete

- Gmail: gomezbot602@gmail.com
- App Password stored in 1Password (Gomez vault → Google entry → "app password" field)
- Script: `/Users/gomez/clawd/scripts/send_email.py` — pulls creds from 1Password
- Test emails sent successfully

## Research Capabilities Demonstrated

- **Veggie pesticide report** — spawned sub-agent, researched EWG Dirty Dozen, emailed results
- **YouTube channel analysis** — analyzed @HumbleConvictionStartups, last 10 videos + metrics, emailed results
- Pattern: spawn sub-agent for long research, email results to Chuck

## Self-Review System Added

- HEARTBEAT.md: hourly self-check questions
- AGENTS.md: startup instructions to read self-review.md, check MISS tags
- memory/self-review.md: log MISS/FIX entries with tags [confidence|uncertainty|speed|depth]

## In Progress

- GitHub CLI setup — needs `brew install gh` then `gh auth login`

## Sensitive Data Cleanup

- Redacted API keys, OAuth tokens, app passwords from session logs and gateway logs
- Email script now pulls from 1Password (no hardcoded secrets)
